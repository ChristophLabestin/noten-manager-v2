          try {
            const key = await deriveKeyFromPassword(user.uid, salt);
            if (cancelled) return;
            setEncryptionKey(key);
            activeKey = key;
          } catch (err) {
            console.error("[Home] deriveKeyFromPassword failed:", err);
            activeKey = null;
          }
        } else {
          activeKey = encryptionKey;
        }

        // 3) Fächer laden
        setPct(35, "Fächer laden …");
        let subjectsSnapshot;
        try {
          const subjectsRef = collection(db, "users", user.uid, "subjects");
          subjectsSnapshot = await getDocs(subjectsRef);
          if (cancelled) return;
        } catch (err) {
          console.error("[Home] getDocs(subjects) failed:", err);
